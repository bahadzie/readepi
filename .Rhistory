head(meta.burkina)
head(burkina.nextclade.data)
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$sceening_date[idx]
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data
metadata.burkina
head(meta.burkina)
metadata.burkina = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Fasso_data.txt"
meta.burkina = data.table::fread(metadata.burkina)
head(meta.burkina)
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data
gambia.nextclade.data = rbind(gambia16.nextclade.data, gambia10.nextclade.data)
head(gambia.nextclade.data)
gambia.nextclade.data
burkina.nextclade.data
head(gambia.nextclade.data)
head(burkina.nextclade.data)
gambia.burkina = rbind(gambia.nextclade.data, burkina.nextclade.data)
barplot(prop.table(table(gambia.burkina$clade)))
prop.table(table(gambia.burkina$clade))
(0.10169492  +    0.06779661 )*100
ggplot(data=gambia.burkina, aes(x=clade)) +
geom_bar(stat="identity", fill="steelblue")
data.frame(prop.table(table(gambia.burkina$clade)))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue")
clade.df = data.frame(prop.table(table(gambia.burkina$clade))) %>% dplyr::rename(clade=Var1)
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue")
clade.df = data.frame(prop.table(table(gambia.burkina$clade))) %>% dplyr::rename(clade=Var1)
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=len), vjust=1.6, color="white", size=3.5)+
theme_minimal()
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=Freq), vjust=1.6, color="white", size=3.5)+
theme_minimal()
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
barplot(prop.table(table(gambia.burkina$lineage)))
lineage.df = data.frame(prop.table(table(gambia.burkina$lineage))) %>% dplyr::rename(lineage=Var1)
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
p2
p1+p2
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
p1+p2
ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 50, by = 10))
ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p1+p2
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p1+p2
clade.df.country = data.frame(prop.table(table(gambia.burkina$clade, gambia.burkina$country))) %>% dplyr::rename(clade=Var1)
clade.df.country
data.frame(prop.table(table(gambia.burkina$clade ~ gambia.burkina$country))) %>% dplyr::rename(clade=Var1)
clade.df.country = data.frame(prop.table(table(gambia.burkina$clade, gambia.burkina$country))) %>% dplyr::rename(clade=Var1, country=Var2)
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_brewer(palette="Blues")
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(c("steelblue","#E69F00"))
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00"))
lineage.df.country = data.frame(prop.table(table(gambia.burkina$lineage, gambia.burkina$country))) %>% dplyr::rename(lineage=Var1, country=Var2)
ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D")
(p1+p3) / (p2+p4)
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A")
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + ggtitle("C")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D")
(p1+p3) / (p2+p4)
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A")
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + ggtitle("C")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B") + ylab("")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D") + ylab("") + theme(legend.position = "none")
(p1+p3) / (p2+p4)
ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1), limits=c(0,0.4))
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1), limits=c(0,0.4)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D") + ylab("") + theme(legend.position = "none")
(p1+p3) / (p2+p4)
gambia.nextclade.data$collection_date = as.Date(gambia.nextclade.data$collection_date, format = "%d/%m/%Y")
gambia.nextclade.data
gambia.nextclade.data = gambia.nextclade.data %>% dplyr::filter(!is.na(collection_date))
gambia.nextclade.data
burkina.nextclade.data = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::filter(!is.na(collection_date))
burkina.nextclade.data = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data
burkina.nextclade.data = fread(burkina.nextclade)
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix3))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removeSuffix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix2))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, getSeqName))
burkina.nextclade.data$country = "Burkina"
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::left_join(burkina.pangolin.data, by = "seqName")
burkina.genomes = Biostrings::readDNAStringSet(burkina.genome.data)
seq.name = names(burkina.genomes)
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(burkina.genomes)
df = data.frame(seq.name, sequence)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
burkina.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(burkina.nextclade.data, by = "seqName")
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data$collection_date = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::filter(!is.na(collection_date))
burkina.nextclade.data
gambian.data = gambia.nextclade.data %>% dplyr::filter(country=="Gambia")
clade.period = gambian.data %>%
# group by clade
group_by(clade) %>%
# transform to date format with lubridate
mutate(collection_date = ymd(collection_date)) %>%
# find min and max
summarise(start = min(collection_date),
end = max(collection_date))
clade.period
clade.period$end[1] = "2021-03-03"
clade.period$end[2] = "2021-01-28"
gambian.data.long = clade.period %>%
mutate(start = ymd(start),
end = ymd(end)) %>%
gather(date.type, collection_date, -c(clade)) %>%
arrange(date.type, clade) %>%
mutate(clade = factor(clade, levels=rev(unique(clade)), ordered=TRUE))
gambian.data.long
kable(clade.period, "html") %>% kable_styling("striped") %>% scroll_box(width = "95%")
clade.period.burkina = burkina.nextclade.data %>%
# group by clade
group_by(clade) %>%
# transform to date format with lubridate
mutate(collection_date = ymd(collection_date)) %>%
# find min and max
summarise(start = min(collection_date),
end = max(collection_date))
clade.period.burkina
burkina.data.long = clade.period.burkina %>%
mutate(start = ymd(start),
end = ymd(end)) %>%
gather(date.type, collection_date, -c(clade)) %>%
arrange(date.type, clade) %>%
mutate(clade = factor(clade, levels=rev(unique(clade)), ordered=TRUE))
burkina.data.long$country="Burkina"
gambian.data.long$country="Gambia"
data.long.all = rbind(burkina.data.long, gambian.data.long)
data.long.all$country=factor(data.long.all$country)
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), size=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
?geom_line
data.long.all
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6)
theme_gantt <- function(base_size=11, base_family="serif") {
ret <- theme_bw(base_size, base_family) %+replace%
theme(panel.background = element_rect(fill="#ffffff", colour=NA),
axis.title.x=element_text(vjust=-0.2), axis.title.y=element_text(vjust=1.5),
title=element_text(vjust=1.2, family="serif"),
panel.border = element_blank(), axis.line=element_blank(),
panel.grid.minor=element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.major.x = element_line(size=0.5, colour="grey80"),
axis.ticks=element_blank(),
legend.position="bottom",
axis.title=element_text(size=rel(0.8), family="serif"),
strip.text=element_text(size=rel(1), family="serif"),
strip.background=element_rect(fill="#ffffff", colour=NA),
panel.spacing.y=unit(1.5, "lines"),
legend.key = element_blank())
ret
}
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") + xlab("") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + xlab("")
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") +
theme(axis.text.x=element_blank()) +  #text(angle=45, hjust=1)
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + xlab("")
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B") + ylab("") + xlab("") +
theme(axis.text.x=element_blank())
install.packages("checkmate")
install.packages("magrittr")
install.packages("odbc")
install.packages("R.utils")
install.packages("writexl")
install.packages("readr")
install.packages("data.table")
install.packages("tidyverse")
install.packages("REDCapR")
install.packages("rio")
install.packages("doParallel")
install.packages("httr2")
install.packages("httr")
install.packages("covr")
install.packages("testthat")
install.packages("knitr")
install.packages("rmarkdown")
install.packages("devtools")
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
devtools::build_readme()
parallel::detectCores()-1
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
install.packages("odbc")
library(odbc)
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
odbc::odbcListDrivers()
credentials.file = system.file("extdata", "test.ini", package = "readepi")
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
library(readepi)
library(readepi)
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
odbc::odbcListDrivers()
odbc::odbcListDrivers()
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
library(readepi)
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
library(readepi)
library(odbc)
odbc::odbcListDrivers()
?odbc::odbcListDrivers
remove.packages("odbc")
install.packages("odbc")
install.packages("odbc")
PKG_CFLAGS
odbc::odbcListDrivers()
odbc::odbcListDrivers()
remove.packages("odbc")
install.packages("odbc")
install.packages("odbc")
odbc::odbcListDrivers()
devtools::install_github("r-dbi/odbc")
odbc::odbcListDrivers()
library(odbc)
odbcListDrivers()
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 18 for SQL Server")
remove.packages("readepi")
library(readepi)
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 18 for SQL Server")
odbcListDrivers()
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 18 for SQL Server")
library(readepi)
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
devtools::install_github("r-dbi/odbc")
devtools::install_github("r-dbi/odbc", force = TRUE)
library(odbc)
odbcListDrivers()
showTables(credentials.file=system.file("extdata", "test.ini", package = "readepi"), project.id="IBS_BHDSS", driver.name="ODBC Driver 17 for SQL Server")
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = "dss_events")
credentials.file = system.file("extdata", "test.ini", package = "readepi")
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = "dss_events")
show_example_file()
remove.packages("readepi")
library(readepi)
show_example_file()
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = "dss_events")
table.names = "accounts,account_books,account_currencies" #can also be table.names = c("account"s,"account_books","account_currencies")
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = table.names)
credentials.file = system.file("extdata", "test.ini", package = "readepi")
table.names = "accounts,account_books,account_currencies" #can also be table.names = c("account"s,"account_books","account_currencies")
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = table.names)
credentials.file
credentials = readMSsqlCredentials(credentials.file)
credentials = readCredentials(credentials.file, project.id="IBS_BHDSS")
credentials
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
driver.name="ODBC Driver 17 for SQL Server"
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
table.name = "accounts,account_books,account_currencies"
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
fields=NULL; records=NULL
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
credentials
credentials$pwd
table.name = "accounts,account_books"
res = read_from_ms_sql_server(user=credentials$user, password=credentials$pwd, host=credentials$host, port=credentials$port,
database.name=credentials$project, table.names=table.name, driver.name=driver.name, records=records,
fields=fields)
con = DBI::dbConnect(odbc::odbc(),
driver = driver.name,
server = host,
database = database.name,
uid = user,
pwd = password,
port = as.numeric(port))
driver="ODBC Driver 17 for SQL Server"
server = credentials$host
database=credentials$project
uid =credentials$user
pwd =credentials$pwd
port = as.numeric(credentials$port))
port = as.numeric(credentials$port)
con = DBI::dbConnect(odbc::odbc(),
driver = driver.name,
server = host,
database = database.name,
uid = user,
pwd = password,
port = as.numeric(port))
server
host=server
database.name=database
user=uid
password=pwd
con = DBI::dbConnect(odbc::odbc(),
driver = driver.name,
server = host,
database = database.name,
uid = user,
pwd = password,
port = as.numeric(port))
tables = DBI::dbListTables(conn = con)
table.names = "accounts,account_books,account_currencies" #can also be table.names = c("account"s,"account_books","account_currencies")
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = table.names)
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = "dss_events")
devtools::build_readme()
devtools::load_all(".")
library(readepi)
data = readepi(credentials.file, project.id="IBS_BHDSS", driver.name = "ODBC Driver 17 for SQL Server", table.name = "dss_events")
head(data$dss_events)
class(data$dss_events)
#' @examples data = subsetFields(data.frame=data$dss_events, fields="id,data_entry_date", table.name="dss_events")
#' @examples data = subsetRecords(data.frame, records, id.position=1, table.name)
data.frame=data$dss_events
fields = "id,data_entry_date start_date,status"
records = "1,2,3,5,8"
id.position=1
not.found = 0
records = as.character(unlist(strsplit(records, ",")))
id.column.name = names(data.frame)[id.position]
id.column.name
is.numeric(data.frame[[id.column.name]])
records="1,2,3,5,8"
records
not.found = 0
records = as.character(unlist(strsplit(records, ",")))
id.column.name = names(data.frame)[id.position]
if(is.numeric(data.frame[[id.column.name]])){
records = as.numeric(records)
}
records
idx = which(records %in% data.frame[[id.column.name]])
idx
idx = match(records, data.frame[[id.column.name]])
idx
idx=c(idx,NA,NA)
idx = idx[!is.na(idx)]
idx
m=c(idx,NA,NA)
which(is.na(m))
m = match(records, data.frame[[id.column.name]])
idx = m[!is.na(m)]
records = records[idx]
data = data.frame %>% dplyr::filter(data.frame[[id.column.name]] %in% records)
records = records[idx]
data = data.frame[which(data.frame[[id.column.name]] %in% records),]
records
library(readepi)
data = data.frame[1:50,1:5]
library(data.table)
fwrite(data,"/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/test_subset.txt", col.names = TRUE, row.names = TRUE, quote = FALSE, sep = "\t")
library(readepi)
