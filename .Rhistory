gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix))
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix2))
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, getSeqName))
gambia16.nextclade.data$country = "Burkina"
head(gambia16.nextclade.data)
gambia16.nextclade.data = fread(gambia16.nextclade)
head(gambia16.nextclade.data)
removePrefix3 = function(x){gsub("/nfsscratch/Karim/LSHTM/test/barcode11/", "", x)}
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix3))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removeSuffix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix2))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, getSeqName))
burkina.nextclade.data$country = "Burkina"
head(burkina.nextclade.data)
head(burkina.pangolin.data)
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::left_join(burkina.pangolin.data, by = "seqName")
head(burkina.nextclade.data)
gambia16.nextclade.data = fread(gambia16.nextclade)
gambia16.nextclade.data = gambia16.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix3))
head(gambia16.nextclade.data)
removePrefix3 = function(x){gsub("/nfsscratch/Karim/LSHTM/test/", "", x)}
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix3))
head(gambia16.nextclade.data)
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removeSuffix))
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix))
# gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, removePrefix2))
gambia16.nextclade.data$seqName = as.character(lapply(gambia16.nextclade.data$seqName, getSeqName))
head(gambia16.nextclade.data)
head(gambia16.pangolin.data)
gambia16.nextclade.data$country = "Burkina"
gambia16.nextclade.data = gambia16.nextclade.data %>% dplyr::left_join(gambia16.pangolin.data, by = "seqName")
head(gambia16.nextclade.data)
head(gambia10.nextclade.data)
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removeSuffix))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removePrefix))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removePrefix2))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, getSeqName))
head(gambia10.nextclade.data)
gambia10.nextclade.data = gambia10.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
head(gambia10.nextclade.data)
gambia10.nextclade.data$country = "Burkina"
gambia10.nextclade.data = gambia10.nextclade.data %>% dplyr::left_join(gambia10.pangolin.data, by = "seqName")
gambia10.nextclade.data
gambia16.nextclade.data
burkina.nextclade.data
gambia10.genome.data = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gam10_consensus/consensus_genomes.fasta"
gambia16.genome.data = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/gambia_consensus.fasta"
burkina.genome.data = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Copie_de_44seq_CHUSS_march_2021_final.fasta"
burkina.genomes = Biostrings::readDNAStringSet(burkina.genome.data)
seq.name = names(burkina.genomes)
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(burkina.genomes)
df = data.frame(seq.name, sequence)
head(df)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
df = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(nextclade.data, by = "seqName")
View(df)
burkina.genomes = Biostrings::readDNAStringSet(burkina.genome.data)
seq.name = names(burkina.genomes)
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(burkina.genomes)
df = data.frame(seq.name, sequence)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
burkina.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(burkina.nextclade.data, by = "seqName")
View(burkina.nextclade.data)
gambia16.genomes = Biostrings::readDNAStringSet(gambia16.genome.data)
seq.name = names(gambia16.genomes)
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(gambia16.genomes)
df = data.frame(seq.name, sequence)
View(df)
gambia16.genomes = Biostrings::readDNAStringSet(gambia16.genome.data)
seq.name = names(gambia16.genomes)
seq.name
seq.name = as.character(lapply(seq.name, removePrefix3))
seq.name
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name
seq.name = as.character(lapply(seq.name, getSeqName))
seq.name
sequence = paste(gambia16.genomes)
df = data.frame(seq.name, sequence)
View(df)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
gambia16.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(gambia16.nextclade.data, by = "seqName")
View(gambia16.nextclade.data)
gambia10.genomes = Biostrings::readDNAStringSet(gambia10.genome.data)
seq.name = names(gambia10.genomes)
seq.name = as.character(lapply(seq.name, removePrefix3))
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(gambia10.genomes)
df = data.frame(seq.name, sequence)
View(df)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
gambia10.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(gambia10.nextclade.data, by = "seqName")
View(gambia10.nextclade.data)
clade_assignment(merged.fasta="/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gam10_consensus/consensus_genomes.fasta",
output.dir="/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gam10_assignment")
gambia10.nextclade.data = fread(gambia10.nextclade)
gambia10.pangolin.data = fread(gambia10.pangolin)
gambia10.pangolin.data = gambia10.pangolin.data %>% dplyr::select(c(taxon, lineage))
head(gambia10.pangolin.data)
gambia10.pangolin.data$taxon = as.character(lapply(gambia10.pangolin.data$taxon, removePrefix2))
names(gambia10.pangolin.data)[1] = "seqName"
gambia10.pangolin.data$seqName = as.character(lapply(gambia10.pangolin.data$seqName, getSeqName))
gambia10.pangolin.data$seqName = as.character(lapply(gambia10.pangolin.data$seqName, removePrefix))
head(gambia10.pangolin.data)
gambia10.nextclade.data = gambia10.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removeSuffix))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removePrefix))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, removePrefix2))
gambia10.nextclade.data$seqName = as.character(lapply(gambia10.nextclade.data$seqName, getSeqName))
gambia10.nextclade.data$country = "Burkina"
gambia10.nextclade.data = gambia10.nextclade.data %>% dplyr::left_join(gambia10.pangolin.data, by = "seqName")
head(gambia10.nextclade.data)
gambia10.genomes = Biostrings::readDNAStringSet(gambia10.genome.data)
seq.name = names(gambia10.genomes)
seq.name = as.character(lapply(seq.name, removePrefix3))
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(gambia10.genomes)
df = data.frame(seq.name, sequence)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
gambia10.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(gambia10.nextclade.data, by = "seqName")
head(gambia10.nextclade.data)
head(gambia16.nextclade.data)
head(burkina.nextclade.data)
bad.samples = NULL
bad.samples = rbind(bad.samples, gambia10.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples = rbind(bad.samples, gambia16.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples = rbind(bad.samples, burkina.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples
gambia16.nextclade.data$country = "Gambia"
gambia10.nextclade.data$country = "Gambia"
bad.samples = NULL
bad.samples = rbind(bad.samples, gambia10.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples = rbind(bad.samples, gambia16.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples = rbind(bad.samples, burkina.nextclade.data %>% dplyr::filter(`%missingBP`>=50))
bad.samples
kable(bad.samples, "html") %>% kable_styling("striped") %>% scroll_box(width = "95%")
idx = which(gambia16.nextclade.data$seqName %in% bad.samples$seqName)
idx
gambia16.nextclade.data = gambia16.nextclade.data[-idx,]
gambia.nextclade.data = rbind(gambia16.nextclade.data, gambia10.nextclade.data)
gambia.nextclade.data
metadata.burkina = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Fasso_data.xlsx"
metadata.gambia10 = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gambian_data_of_interest.xlsx"
metadata.gambia16 = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gambia16_screening_date.xlsx"
meta.gambia10 = readxl::read_xlsx(metadata.gambia10)
meta.gambia16 = readxl::read_xlsx(metadata.gambia16)
meta.burkina = readxl::read_xlsx(metadata.burkina)
head(meta.gambia16)
head(gambia16.nextclade.data)
idx = match(gambia16.nextclade.data$seqName, meta.gambia$barcode_number)
idx = match(gambia16.nextclade.data$seqName, meta.gambia16$barcode_number)
metadata.gambia16
metadata.gambia16="/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gambia16_screening_date.txt"
meta.gambia16 = fread(metadata.gambia16)
meta.gambia16
idx = match(gambia16.nextclade.data$seqName, meta.gambia16$barcode_number)
gambia16.nextclade.data$collection_date = meta.gambia16$dateofadmission[idx]
gambia16.nextclade.data
gambia16.nextclade.data$collection_date = meta.gambia16$sceening_date[idx]
gambia16.nextclade.data
metadata.burkina = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Fasso_data.txt"
metadata.gambia10 = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gambian_data_of_interest.txt"
metadata.gambia16 = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Gambia16_screening_date.txt"
meta.gambia10 = data.table::fread(metadata.gambia10)
meta.gambia10
gambia10.nextclade.data
idx = match(gambia10.nextclade.data$seqName, meta.gambia10$lab_id)
gambia10.nextclade.data$collection_date = meta.gambia10$sceening_date[idx]
gambia10.nextclade.data
head(meta.burkina)
head(burkina.nextclade.data)
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$sceening_date[idx]
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data
metadata.burkina
head(meta.burkina)
metadata.burkina = "/Users/karimmane/Documents/Karim/LSHTM/TRACE_dev/Genomic_data/Fasso_data.txt"
meta.burkina = data.table::fread(metadata.burkina)
head(meta.burkina)
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data
gambia.nextclade.data = rbind(gambia16.nextclade.data, gambia10.nextclade.data)
head(gambia.nextclade.data)
gambia.nextclade.data
burkina.nextclade.data
head(gambia.nextclade.data)
head(burkina.nextclade.data)
gambia.burkina = rbind(gambia.nextclade.data, burkina.nextclade.data)
barplot(prop.table(table(gambia.burkina$clade)))
prop.table(table(gambia.burkina$clade))
(0.10169492  +    0.06779661 )*100
ggplot(data=gambia.burkina, aes(x=clade)) +
geom_bar(stat="identity", fill="steelblue")
data.frame(prop.table(table(gambia.burkina$clade)))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue")
clade.df = data.frame(prop.table(table(gambia.burkina$clade))) %>% dplyr::rename(clade=Var1)
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue")
clade.df = data.frame(prop.table(table(gambia.burkina$clade))) %>% dplyr::rename(clade=Var1)
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=len), vjust=1.6, color="white", size=3.5)+
theme_minimal()
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=Freq), vjust=1.6, color="white", size=3.5)+
theme_minimal()
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
barplot(prop.table(table(gambia.burkina$lineage)))
lineage.df = data.frame(prop.table(table(gambia.burkina$lineage))) %>% dplyr::rename(lineage=Var1)
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
p2
p1+p2
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal()
p1+p2
ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 50, by = 10))
ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p1+p2
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p1+p2
clade.df.country = data.frame(prop.table(table(gambia.burkina$clade, gambia.burkina$country))) %>% dplyr::rename(clade=Var1)
clade.df.country
data.frame(prop.table(table(gambia.burkina$clade ~ gambia.burkina$country))) %>% dplyr::rename(clade=Var1)
clade.df.country = data.frame(prop.table(table(gambia.burkina$clade, gambia.burkina$country))) %>% dplyr::rename(clade=Var1, country=Var2)
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_brewer(palette="Blues")
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(c("steelblue","#E69F00"))
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00"))
lineage.df.country = data.frame(prop.table(table(gambia.burkina$lineage, gambia.burkina$country))) %>% dplyr::rename(lineage=Var1, country=Var2)
ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D")
(p1+p3) / (p2+p4)
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A")
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ylab("") +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + ggtitle("C")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D")
(p1+p3) / (p2+p4)
p1 = ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A")
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
p2 = ggplot(data=lineage.df, aes(x=lineage, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + ggtitle("C")
p3 = ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B") + ylab("")
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D") + ylab("") + theme(legend.position = "none")
(p1+p3) / (p2+p4)
ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1), limits=c(0,0.4))
p4 = ggplot(data=lineage.df.country, aes(x=lineage, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1), limits=c(0,0.4)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("D") + ylab("") + theme(legend.position = "none")
(p1+p3) / (p2+p4)
gambia.nextclade.data$collection_date = as.Date(gambia.nextclade.data$collection_date, format = "%d/%m/%Y")
gambia.nextclade.data
gambia.nextclade.data = gambia.nextclade.data %>% dplyr::filter(!is.na(collection_date))
gambia.nextclade.data
burkina.nextclade.data = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::filter(!is.na(collection_date))
burkina.nextclade.data = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data
burkina.nextclade.data = fread(burkina.nextclade)
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::select(c(seqName, clade, Nextclade_pango, clade_who, qc.overallStatus))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix3))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removeSuffix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, removePrefix2))
burkina.nextclade.data$seqName = as.character(lapply(burkina.nextclade.data$seqName, getSeqName))
burkina.nextclade.data$country = "Burkina"
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::left_join(burkina.pangolin.data, by = "seqName")
burkina.genomes = Biostrings::readDNAStringSet(burkina.genome.data)
seq.name = names(burkina.genomes)
seq.name = as.character(lapply(seq.name, removeSuffix))
seq.name = as.character(lapply(seq.name, removePrefix))
seq.name = as.character(lapply(seq.name, removePrefix2))
seq.name = as.character(lapply(seq.name, getSeqName))
sequence = paste(burkina.genomes)
df = data.frame(seq.name, sequence)
for(i in 1:nrow(df)){
df$`%missingBP`[i] = ((stringr::str_count(df$sequence[i], pattern = "N"))/nchar(df$sequence[i]))*100
}
burkina.nextclade.data = df %>% dplyr::select(c(seq.name,`%missingBP`)) %>% dplyr::rename(seqName=seq.name) %>% dplyr::left_join(burkina.nextclade.data, by = "seqName")
idx = match(burkina.nextclade.data$seqName, meta.burkina$lab_id)
burkina.nextclade.data$collection_date = meta.burkina$screening_date[idx]
burkina.nextclade.data$collection_date = as.Date(burkina.nextclade.data$collection_date, format = "%d/%m/%Y")
burkina.nextclade.data = burkina.nextclade.data %>% dplyr::filter(!is.na(collection_date))
burkina.nextclade.data
gambian.data = gambia.nextclade.data %>% dplyr::filter(country=="Gambia")
clade.period = gambian.data %>%
# group by clade
group_by(clade) %>%
# transform to date format with lubridate
mutate(collection_date = ymd(collection_date)) %>%
# find min and max
summarise(start = min(collection_date),
end = max(collection_date))
clade.period
clade.period$end[1] = "2021-03-03"
clade.period$end[2] = "2021-01-28"
gambian.data.long = clade.period %>%
mutate(start = ymd(start),
end = ymd(end)) %>%
gather(date.type, collection_date, -c(clade)) %>%
arrange(date.type, clade) %>%
mutate(clade = factor(clade, levels=rev(unique(clade)), ordered=TRUE))
gambian.data.long
kable(clade.period, "html") %>% kable_styling("striped") %>% scroll_box(width = "95%")
clade.period.burkina = burkina.nextclade.data %>%
# group by clade
group_by(clade) %>%
# transform to date format with lubridate
mutate(collection_date = ymd(collection_date)) %>%
# find min and max
summarise(start = min(collection_date),
end = max(collection_date))
clade.period.burkina
burkina.data.long = clade.period.burkina %>%
mutate(start = ymd(start),
end = ymd(end)) %>%
gather(date.type, collection_date, -c(clade)) %>%
arrange(date.type, clade) %>%
mutate(clade = factor(clade, levels=rev(unique(clade)), ordered=TRUE))
burkina.data.long$country="Burkina"
gambian.data.long$country="Gambia"
data.long.all = rbind(burkina.data.long, gambian.data.long)
data.long.all$country=factor(data.long.all$country)
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), size=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
?geom_line
data.long.all
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6)
theme_gantt <- function(base_size=11, base_family="serif") {
ret <- theme_bw(base_size, base_family) %+replace%
theme(panel.background = element_rect(fill="#ffffff", colour=NA),
axis.title.x=element_text(vjust=-0.2), axis.title.y=element_text(vjust=1.5),
title=element_text(vjust=1.2, family="serif"),
panel.border = element_blank(), axis.line=element_blank(),
panel.grid.minor=element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.major.x = element_line(size=0.5, colour="grey80"),
axis.ticks=element_blank(),
legend.position="bottom",
axis.title=element_text(size=rel(0.8), family="serif"),
strip.text=element_text(size=rel(1), family="serif"),
strip.background=element_rect(fill="#ffffff", colour=NA),
panel.spacing.y=unit(1.5, "lines"),
legend.key = element_blank())
ret
}
ggplot(data.long.all, aes(x=clade, y=collection_date)) +  #, group=clade
geom_line(aes(color = country), position = position_dodge(0.3), linewidth=6) +
geom_vline(xintercept=x.breaks, colour="grey80", linetype="dotted") +
guides(colour=guide_legend(title=NULL)) +
labs(x=NULL, y=NULL) + coord_flip() +
scale_y_date(date_breaks="1 month", labels=date_format("%b ‘%y")) +    #2 weeks
theme_gantt() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_color_manual(values=c('steelblue','#E69F00'))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") + xlab("") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1))
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + xlab("")
ggplot(data=clade.df, aes(x=clade, y=Freq)) +
geom_bar(stat="identity", fill="steelblue") +
geom_text(aes(label=round(Freq,3)), vjust=1.6, color="white", size=3.5)+
theme_minimal() + ggtitle("A") +
theme(axis.text.x=element_blank()) +  #text(angle=45, hjust=1)
scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) + xlab("")
ggplot(data=clade.df.country, aes(x=clade, y=Freq, fill=country)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
theme_minimal() + scale_y_continuous(breaks = seq(0, 0.5, by = 0.1)) +
scale_fill_manual(values=c("steelblue","#E69F00")) + ggtitle("B") + ylab("") + xlab("") +
theme(axis.text.x=element_blank())
